2025-11-04
- update gfr.js - a. because of changes in prot.js sep of resp b. updated comments
- removed old and unused div from kontrast. Changes in prot.js here
- somewhat better sep of resp in prot.js
- Better beslut

2025-11-03_2
- möjlighet att filterera protokolllistan enligt tags i comments

2025-11-03
- Lagt till varning vid BMI > 40 (såsom finns i Omnivis)
- tagit bort updprot.html, det var så uselt att det inte kan rimligt användas
- Hjälpligt validerat protokollresultat (volym/inj.hast/kvot) mot Omnivis/Omniject.
  Följande värden (utelämnat värde = samma värde som närmast föregående i samma kolumn):
    Värden i protokoll jmf med omnivis för följande:
    Ålder    Längd    Vikt    Kreatinin     Prot      OK?
    60         170      75          100    Aorta      ok  kvinna
                                         Bukkärl      ok  kvinna
    40         170      75          150   buk<40      ok  kvinna
                                             buk      ok  kvinna
                        90                   buk      ok  kvinna
                                            hals      ok  kvinna
    80                                      hals      ok  man
                        60                  hals      ok  man
                                         ge l+p       ok  man
                                        epig inf      ok  man
                                   epig inf 80kv      ok  man
                                                      ok  kvinna
                        90                            ok  kvinna
               160                                    ok  kvinna
                                        buk 80kv      ok  kvinna




2025-11-02 (2)
- Bump av programversion: 0.5.7
- Added tools/updprot.html to add and remove protocols. NOT a nice ui.
- Fixed 2 bugs in tools/viewusprot.html  (array assignment is reference assignement...).
  Havent checked it thoroughly, uses [...array] which seems to be a shallow copy of the array


2025-11-02
- renamed tools/convprottocsv.html to prot2csv.html, minor changes to the file
- renamed tools/convprottoinjhastcsv.html tp prot2injhastcsv.html, minor changes to the file
- for..in to for..of everywhere gfr.js, prot.js, vol.js)
- Bug when iterating over object fixed (gfr.js). The interation was dependent on the javascript order of for (a in object), which is def.
- small changes (text) to kontrast.html
- removed ref to undersökningar in prot.js
- prot2csv.html - moved function to tools.js. Updated text.
- prot2injhastcsv.html - moved function to tools.js. Updated text.
- tools.js - added comments. funcs for generatin csv moved to file from prot2csv and prot2injhastcsv. Func to display table with prot moved to file from other file.
             func to convert prot to str (JSON.stringify not nice). Added func htmlEscape (str -> str with html entities).
             Added func rawText (str with html entities -> raw text)
- viewusprot.html - added possibility to filter table of protocols => added new funcs. Moved out func to gen table to tools.js.
- added csv2prot.html - read csv-file (as from prot2csv.html) and convert to protocol-format
- added ih2prot.html - read csv-file in "InjHast.txt"-format and conver to protocol-format. 
                       => This is probably more stable than tojson3.py, which should be considered deprecated.
- Added papaparse (csv parsing library)
- Added tools/prot2csvraw.html - like prot2csv.html but without html entities (raw text )
- Added tools/csvraw2prot.html converts raw csv data for example from prot2csvraw.html to protocol data


2025-11-01
- moved filformat.txt and info.txt to doc directory
- moved convertprottocsv.html to tools, renamed it to convprottoinjhastcsv.html, fixed it for new format of protokoll, added save button and some info
- added tools.js for tools to use with html "scripts" in the tools directory
- moved viewusprot.html to tools and updated to to reflect new layout of protocol (and where us is longer used)
- updated gitignore and moved a non versioned file to temp
- minor change to kontrast.html
- updated format for protokoll_data.js - removed id since it was not used, and added comment (comment can be used for filtering of protocol array ...)
- updated tojson3.py to reflect the stuff above
- added html script to convert protocols to csv with the same format as protocols and with html entities ( tools/convprottocsv.html )



2025-10-31
- Bump av programversion: 0.5.6
MAJOR:
1. Ändrat till att välja "protokoll" istf "undersökning"
2. Tagit bort filer sek. till ovan
3. Något ändrat format för protkoll_data.js sek till ovan (nu: array)
4. Sorterar ovanstående array innan den presenteras i select box
5. Ändrat tools/tojson3.py sek. till ovan
MINOR:
1. Uppdaterat protokoll_data.js till senaste version enl källa



2025-10-23
- Bump av programversion: 0.5.5
MAJOR:
1. Notera att Omnivis använder LM-LBM (lean body mass!!!)
   Därför ändrat standardmetod från REV-LM till LM-LBM
2. Validering av LM-LBM metod. Inget bra sätt att göra en validering mot omnivis (Omnivis har inte har något api)
   Validerat (jmf värden) enligt test-katalog mot egen kod enligt omnivis-dokument och originalart
      ( ./test/test-lm-lbm.html, ./test/lm-lbm-validation_results.csv, ./test/validate-lm-lbm.R )
   Följande testat mot omnivis, för båda könen, och stämmer med omnivis:
   ålder,langd,vikt,kreat
   20,130,30,50
   20,170,30,170
   20,170,150,90
   60,170,30,50
   60,210,70,90
   60,170,110,170
   20,130,30,170
   60,130,150,170
3. Validerat rev-lm mot omnivis för följande värden (båda könen):
   ålder,kreat
   20,50
   20,170
   20,90
   60,50
   60,90
   60,170
   20,170
   60,170
   20,190
   60,190
   80,190
4. Lagt till g jod mm vid eget angivande av volym i volymsberäkningsdelen
5. Beräkning av rGFR för barn alltid enligt den reviderade LM-metoden (enligt LT)
MINOR:
1. Added info about non validated gfr methods to func.js
2. Some new comments in func.js
3. Moved initialization of function pointer from gfr.js to javascript in kontrast.html to have everything in one place
4. Commented out possibility to use non validated gfr methods from kontrast.html
5. Some new todos and bugs in todo.txt
6. updated tools/info.txt - removed old information





2025-10-12
- Bump av programversion: 0.5.4b
- Uppdatering av gfr data medför en omräkning av protokolldata, om möjligt (rättning av bug 2025-10-11)
  Det är dock inte konsekvent, huvudsakligen för att det kan bli irriterande.
- Moved some js from kontrast to main.js

2025-10-11
- bump av programversion
- Bättre integrering mellan gfr och protokoll - ej klart (se bug)
- Möjlighet att bara räkna bmi
- Möjlighet att bara ange vikt för användning i protkoll-delen
- Flyttat upp protkolldelen till under gfr-delen
- Tagit bort en del i samband med ovan onödiga knappar
- protokoll hämtar nu vikt och agfr från gfr-delen, tex hobr() behövs därför inte längre 
- pf_form2_filled ser inte ut att behövas - har alltid samma värde som proto_ok
- warning_pkvot_change behövs inte
- fix av genbeslut
- css utflyttat till egen fil - vill inte ha så stor kontrast.html. Flytta även i kontrast.html kvarvarande js?
- i övrigt något bättre css
Bug:
- Protokoll uppdateras inte när vikt/gfr ändas


2025-10-06
- Skrivfel i en av metodenra för att beräkna gfr. Rättat.
- Småändringar

2025-10-06
Validering
( se: ./test/test-revlm.html ./test/validate-revlm.R  ./test/validate-childkreat.R )
- rev-LM validerad mot kod från egfr.se för ålder från 20 till 110 i steg om 10, kreat 10 till 300 i steg om 10, och båda könen
- rev-LM validerad mot algoritm i originalartikel (som ovan)
- alg för reviderat barn-kreat validerad mot kod från egfr för ålder från 2 till 17 år, kreat 10 till 300 i steg om 10, och båda könen
- alg för reviderat barn-kreat validerad mot algoritm i läkartidningen (som ovan)



